<html>
<head>
  <title>Lecture 23 - C++ Exceptions</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/270387 (en-US); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="281"/>
<h1>Lecture 23 - C++ Exceptions</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><ul><li>Error handling strategies</li><li>Basic exception mechanisms: <font face="Consolas">try/throw/catch</font></li><li>Functions &amp; exceptions, constructors &amp; exceptions</li><li>STL exceptions</li><li>RAII &quot;Resource Acquisition is Initialization&quot;</li><li>Structured Exception Handling in the Windows Operating System</li><li>Google's C++ Style Guide on Exceptions</li></ul><div><b>23.1 Error Handling Strategy A: Optimism (a.k.a. Naivety or Denial)</b></div><div><b><br></b></div><div>assume there are no errors</div><div>command line arguments will always be proper, specified files are always available, etc</div><div><br></div><div>this may not be a disaster for small programs</div><div>     fastest to develop</div><div><br></div><div>challenging to maintain large programs using this method</div><div>     difficult to pinpoint the source of an error</div><div>     maintainer must be familiar with the assumptions of the code</div><div><br></div><div><b>23.2 Error Handling Strategy B: Plan for the Worst Case (a.k.a. Paranoia)</b></div><div><b><br></b></div><div>anticipate every mistake or source of error</div><div>write lots of if statements everywhere there may be a problem</div><div><br></div><div>write code for what to do instead, print out error messages, and/or exit when nothing seems reasonable</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image.png" type="image/png" style="cursor: default;cursor: default;"/></div><div>important to not check if it's zero</div><div>     rounding floating point numbers can make it seem like it's zero</div><div><br></div><div>requires a lot of programmer time</div><div>     bulkier and harder to understand/maintain</div><div>     </div><div>if a nested function call might have a problem</div><div>     all functions in between must also test for error condition</div><div><br></div><div>creating code that tests all the code can also be complicated as well</div><div><br></div><div><b>23.3 Error Handling Strategy C: If/When It Happens We'll Fix It Later (a.k.a. Procrastination)</b></div><div><b><br></b></div><div>anticipate everything that might go wrong and just call assert in lots of places</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>can be a great tool during software development process</div><div>     quickly get a prototype system up and running that works for the general, most common, non-error case</div><div><br></div><div>use of assertions is generally frowned upon in real-world production code</div><div>     don't like to receive seemingly arbitrary &amp; total system failures</div><div><br></div><div>once you have completed testing &amp; debugging</div><div>     gcc compile flag <font face="Consolas">-DNDEBUG</font> can be used to remove all remaining assert statements</div><div><br></div><div><b>23.4 Error Handling Strategy D: The Elegant Industrial-Strength Solution</b></div><div><br></div><div>use exceptions</div><div><br></div><div>somewhat similar to strategy B</div><div>     but in practice, code using exceptions results in more efficient code</div><div>          less code</div><div>          less prone to programming mistakes</div><div><img src="Lecture 23 - C++ Exceptions_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div><b>23.5 Basic Exception Mechanisms: Throw</b></div><div><b><br></b></div><div>when you detect an error, <font face="Consolas">throw</font> an exception</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [3].png" type="image/png" style="cursor: default;cursor: default;"/></div><div>can throw a value of any type</div><div>when throw statement is triggered, the rest of that block of code is abandoned</div><div><br></div><div><b>23.6 Basic Exception Mechanisms: Try/Catch</b></div><div><b><br></b></div><div>if you suspect that a fragment of code you are about to execute may throw an exception</div><div>     you should wrap the fragment within a try/catch block</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [4].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>logic of the try block may throw more than one type of exception</div><div><br></div><div>catch statement specifies what type of exception it catches</div><div>you may use multiple catch blocks to catch different types of exceptions from the same try block</div><div><br></div><div>may use <font face="Consolas">catch (...) { /* code */ }</font> to catch ALL types of exceptions</div><div>     don't get to use the value that was thrown</div><div><br></div><div>if an exception is thrown, program searches for the closest enclosing try/catch block with appropriate type</div><div>     may be several functions away from the cell stack</div><div><br></div><div>if no appropriate catch statement is found, program exits</div><div><br></div><div><b>23.7 Basic Exception Mechanisms: Functions</b></div><div><b><br></b></div><div>if the function you are writing might throw an exception, you can specify the type of exceptions in the prototype</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [5].png" type="image/png" style="cursor: default;cursor: default;"/></div><div>if you use throw syntax in prototype and function doesn't return an exception of a type you have listed</div><div>     program will terminate immediately</div><div>     can't be caught by any closing try statements</div><div><br></div><div>if no throw syntax in the prototype</div><div>     function may throw exception of any type     </div><div>     they may be caught by appropriate try/catch block</div><div><br></div><div><b>23.8 Comparing Method B (explicit if tests) to Method D (exceptions)</b></div><div><b><br></b></div><div>code using exceptions:</div><div><img src="Lecture 23 - C++ Exceptions_files/Image [6].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [7].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>error propagates through multiple nested function calls</div><div><br></div><div><b>23.9 STL Exception Class</b></div><div><b><br></b></div><div>STL provides a base class <font face="Consolas">std::exception</font> in <font face="Consolas">&lt;exception&gt;</font> header file</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [8].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [9].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>STL library throws several different types of exceptions (all derived from STL exception class)</div><div><img src="Lecture 23 - C++ Exceptions_files/Image [10].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div><b>23.10 Exceptions &amp; Constructors</b></div><div><b><br></b></div><div>only way for a constructor to fail is to throw an exception</div><div><br></div><div>common reason that a constructor must fail is due to a failure to allocate enough memory</div><div>     if system cannot allocate sufficient memory resources for the object</div><div>          <font face="Consolas">bad_alloc</font> exception is thrown</div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [11].png" type="image/png" style="cursor: default;cursor: default;"/></div><div><br></div><div>can also be useful to have the constructor for a custom class throw a descriptive exception</div><div>     if the arguments are invalid in some way</div><div><br></div><div><b>23.11 Resource Acquisition is Initialization (RAII)</b></div><div><b><br></b></div><div>because exceptions might happen at any type and may cause the program to abandon a partially executed function or block of code</div><div>      it may not be appropriate to rely on a delete call that happens later on</div><div><br></div><div>RAII describes programming strategy to ensure proper deallocation of memory despite exceptions</div><div>     goal is to ensure that resources are released before exceptions are allowed to propagate</div><div><br></div><div>variables allocated on the stack are guaranteed to be properly destructed when out of scope</div><div><br></div><div>special care must be taken for dynamically-allocated variables to ensure that code is <i>exception safe</i></div><div><i><br></i></div><div><b>23.12 Structured Exception Handing (SEH) in the Windows Operating System</b></div><div><b><br></b></div><div>Windows has special language supposed called SEH to handle hardware exceptions</div><div>     include divide by zero and segmentation faults</div><div><br></div><div>in Unix/Linux/Mac OSX these hardware exceptions are instead deal with using signal handlers</div><div>     using these incurs a larger performance hit</div><div>     design of code is less elegant</div><div><br></div><div><b>23.13 Google's C++ Style Guide on Exceptions</b></div><div><b><br></b></div><div><a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Exceptions">http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Exceptions</a></div><div><br></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [12].png" type="image/png" style="cursor: default;"/></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [13].png" type="image/png" style="cursor: default;"/></div><div><img src="Lecture 23 - C++ Exceptions_files/Image [14].png" type="image/png" style="cursor: default;"/></div></div>
</div></body></html> 